<script>
	var data = <%= @reports.to_json %>;
	console.log(data);
</script>

<!-- Central content -->
	<div class="container">
		<div class = "row">
			<div class="col-sm-12">
				<h1 class="text-center"><strong>Fix My City!</strong></h1>
				<p>
					Found an issue with your local environment? Tell us and we'll fix it today.
				</p>
			</div>
				
			
				<div class="col-sm-8">

					<table class="table table-bordered table-hover" name="overview_table">
					  <tr class="active">
					    <th>Time/Date</th>
					    <th>Location</th>
					    <th>Type</th>
					    <th>Status</th>
					    <th>Open image</th>
					  </tr>

					  <script>
					  for (var i = 0; i < 10; i++) {
					  	document.write("<tr class='clickableRow' id='" + data[i].id + "'>");
					  	document.write("<td>"+ data[i].created_at + "</td>");
					  	document.write("<td>Bus way</td>");
					  	document.write("<td>Bus stop</td>");
					  	document.write("<td>" + data[i].status + "</td>");
					  	document.write("<td><a href='#'' class='btn btn-primary'><i class='fa fa-file-image-o'></i></a></td>");
					  	document.write("</tr>");
					  }
					  </script>

					  
					</table>

					
				</div>
				<div class="col-sm-4">
					<div class="images" id="images"></div>
				</div>
		</div>

		<div class="row">
			<div class="col-sm-12">

				<div id="map" style="height: 400px; margin-top: 20px; margin-bottom: 20px;"></div>
				
			</div>
		</div>
	</div>

	<!-- Leaflet script -->
	<script>
		var map = L.map('map').setView([51.505, -0.09], 13);
		L.tileLayer('http://{s}.tiles.mapbox.com/v3/melatonind.iofl09ec/{z}/{x}/{y}.png', {
		    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		    maxZoom: 18
		}).addTo(map);
		
		// define markers
		var busstop = L.icon({
		    iconUrl: 'images/markers/busstop.png',

		    iconSize:     [32, 37], // size of the icon
		    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
		    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
		});

		var park = L.icon({
		    iconUrl: 'images/markers/urbanpark.png',

		    iconSize:     [32, 37], // size of the icon
		    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
		    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
		});

		// create markers from data set 
		 for (var i = 0; i < data.length; i++) {
			L.marker([data[i].latitude, data[i].longitude], {icon: busstop}).addTo(map);
		}



		jQuery(document).ready(function($) {
			// Clickable row ability
			$(".clickableRow").click(function() {
				
				var i = $(this).attr("id");
				i -= 1;

				// pan to location
				map.panTo(new L.LatLng(data[i].latitude, data[i].longitude), 13);

				// append image
				var imgUrl = "images/img/" + data[i].photo_url;
				$(".images").html("<a href=" + imgUrl + " data-lightbox='image' data-title=" + data[i].description + "><center><img src='" + imgUrl + "' alt=" + data[i].description + " class='img-responsive'/></center></a><p><h5>Description:</h5>" + data[i].description + "</p>");
			});

	       // Automatically click on first column
	       $('#2').trigger('click');
		});
		</script>